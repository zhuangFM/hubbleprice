package com.netease.yx.dp.udf;

import com.google.gson.*;
import com.netease.yx.dp.model.Coupon;
import com.netease.yx.dp.resolver.CouponResolver;
import com.netease.yx.dp.resolver.PriceResolver;
import org.apache.hadoop.hive.ql.exec.UDF;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.*;

public class OutsidePriceComputeUDF extends UDF {
    private static final Logger logger = LoggerFactory.getLogger(OutsidePriceComputeUDF.class);

    public String evaluate(String htmlStr, String source) {
//        JsonParser jsonParser = new JsonParser();
//        JsonObject obj = (JsonObject) jsonParser.parse(htmlStr);
        Map<String, Object> resultMap = new HashMap<>();
        resultMap.put("processStatus",1); //1表示解析成功

        String content = htmlStr;
//        try{
////            JsonObject dataObj  = (JsonObject) jsonParser.parse(obj.get("data").getAsString());
//            content = obj.get("tb-property").getAsString();
//        } catch (Exception e) {
//            content = "";
//            resultMap.put("errorMsg","tb-property 标签不存在！请检查爬虫数据接口");
//            logger.error("error {},tb-property 标签不存在！请检查爬虫数据接口", e.getStackTrace());
//        }

        //价格获取
        List<Double> priceArr = new PriceResolver().resolve(content, source);
        List<Double> resultPrices = new ArrayList(priceArr);
        resultMap.put("priceList", priceArr);


        try {
            //满减规则
            List<Coupon> coupons = new CouponResolver().resolve(content, source);
            resultMap.put("couponList", coupons);

            //计算结果
            for (double price : priceArr) {
                for (Coupon cop : coupons) {
                    logger.info("价格 {} 使用优惠券 {} 之后价格为 {}", price, cop, cop.getResultMoney(price));
                    resultPrices.add(cop.getResultMoney(price));
                }
            }
        } catch (Exception e) {
            resultMap.put("processStatus",0); //0表示解析失败
            resultMap.put("errorMsg","优惠券解析出错");
            logger.error("error {}", e.getStackTrace());
        }

        Collections.sort(resultPrices);

        try{
            resultMap.put("minPrice", resultPrices.get(0));
            logger.info("最低价为:{}", resultPrices.get(0));
        }catch (Exception e){
            resultMap.put("processStatus",0); //0表示解析失败
            resultMap.put("errorMsg","价格list为空");
            logger.error("error {}",e.getStackTrace());
        }
        Gson gson = new Gson();
        return gson.toJson(resultMap);
    }

    public static String test(String htmlStr, String source) {
        JsonParser jsonParser = new JsonParser();
        JsonObject obj = (JsonObject) jsonParser.parse(htmlStr);
        Map<String, Object> resultMap = new HashMap<>();
        resultMap.put("processStatus",1); //1表示解析成功

        String content;
        try{
            JsonObject dataObj  = (JsonObject) jsonParser.parse(obj.get("data").getAsString());
            content = dataObj.get("tb-property").getAsString();
        } catch (Exception e) {
            content = "";
            resultMap.put("errorMsg","tb-property 标签不存在！请检查爬虫数据接口");
            logger.error("error {},tb-property 标签不存在！请检查爬虫数据接口", e.getStackTrace());
        }

        return content;
    }



    public static void main(String[] args) {
        String content = "{\"timestamp\":1606288358401,\"data\":\"{\\\"sale\\\":\\\"30天内已售出1081件，其中交易成功740件\\\",\\\"priceOrig\\\":\\\"243.75-1581.25\\\",\\\"price\\\":\\\"175.00-819.00\\\",\\\"tb-property\\\":\\\"\\\\n    <div class=\\\\\\\"tb-wrap tb-wrap-newshop\\\\\\\">\\\\n        \\\\n    <div id=\\\\\\\"J_Title\\\\\\\" class=\\\\\\\"tb-title\\\\\\\" shortcut-key=\\\\\\\"t\\\\\\\" shortcut-label=\\\\\\\"查看宝贝标题\\\\\\\" shortcut-effect=\\\\\\\"focus\\\\\\\">\\\\n        <h3 class=\\\\\\\"tb-main-title\\\\\\\" data-title=\\\\\\\"纽翠斯狗粮黑钻红肉11磅幼犬粮5磅鸭哈根纽崔斯进口冻干鸡肉22磅\\\\\\\">\\\\n            纽翠斯狗粮黑钻红肉11磅幼犬粮5磅鸭哈根纽崔斯进口冻干鸡肉22磅\\\\n        </h3>\\\\n\\\\n        \\\\n\\\\n        <p class=\\\\\\\"tb-subtitle\\\\\\\"></p>\\\\n        <div id=\\\\\\\"J_TEditItem\\\\\\\" class=\\\\\\\"tb-editor-menu\\\\\\\">          <div id=\\\\\\\"J_Report\\\\\\\" class=\\\\\\\"tb-report\\\\\\\">                  <p class=\\\\\\\"tb-report-hd\\\\\\\">举报</p>                  <ul class=\\\\\\\"tb-report-bd\\\\\\\">                    <li><a id=\\\\\\\"J_isuit\\\\\\\" href=\\\\\\\"//jubao.taobao.com/index.htm?&amp;spm=a1z6q.7847058&amp;itemId=597308720185\\\\\\\" target=\\\\\\\"_blank\\\\\\\">举报此商品</a></li>                    <li><a href=\\\\\\\"//bbs.taobao.com/catalog/thread/154504-977100.htm?spm=2013.1.1000373.2\\\\\\\" target=\\\\\\\"_blank\\\\\\\">商品举报演示</a></li>                    <li><a href=\\\\\\\"//bbs.taobao.com/catalog/424023.htm?spm=2013.1.1000373.3\\\\\\\" target=\\\\\\\"_blank\\\\\\\">购物安全防骗</a></li>                    <li><a href=\\\\\\\"//315.taobao.com?spm=2013.1.1000373.4\\\\\\\" target=\\\\\\\"_blank\\\\\\\">消费质量曝光</a></li>                  </ul>            </div></div>\\\\n    </div>\\\\n\\\\n<div id=\\\\\\\"J_Banner\\\\\\\" class=\\\\\\\"tb-banner tb-banner-in-promotion\\\\\\\"><div class=\\\\\\\"J_BigProm tb-big-prom\\\\\\\"><img class=\\\\\\\"tb-big-prom-img\\\\\\\" src=\\\\\\\"https://img.alicdn.com/tfs/TB1lP8jqlFR4u4jSZFPXXanzFXa-480-40.png\\\\\\\"></div></div>\\\\n            <ul class=\\\\\\\"tb-meta tb-promo-meta\\\\\\\">\\\\n                \\\\n<li id=\\\\\\\"J_StrPriceModBox\\\\\\\" class=\\\\\\\"tb-detail-price tb-clear J_PriceItem\\\\\\\" shortcut-key=\\\\\\\"p\\\\\\\" shortcut-label=\\\\\\\"查看价格\\\\\\\" shortcut-effect=\\\\\\\"focus\\\\\\\" data-price-wight=\\\\\\\"0\\\\\\\">\\\\n    <span class=\\\\\\\"tb-property-type\\\\\\\">价格</span>\\\\n    <div class=\\\\\\\"tb-property-cont\\\\\\\">\\\\n        <strong id=\\\\\\\"J_StrPrice\\\\\\\" style=\\\\\\\"font-size: 14px; color: rgb(60, 60, 60); font-weight: 400; text-decoration: line-through;\\\\\\\"><em class=\\\\\\\"tb-rmb\\\\\\\">¥</em><em class=\\\\\\\"tb-rmb-num\\\\\\\">243.75-1581.25</em></strong>\\\\n        \\\\n        <span class=\\\\\\\"tb-spec\\\\\\\">14.94元/500g</span>\\\\n        \\\\n    </div>\\\\n</li>\\\\n<li class=\\\\\\\"tb-clear\\\\\\\">\\\\n    \\\\n        <span class=\\\\\\\"tb-property-type\\\\\\\">净重</span>10000g\\\\n        \\\\n    \\\\n</li>\\\\n<li id=\\\\\\\"J_PromoPrice\\\\\\\" class=\\\\\\\"tb-detail-price tb-promo-price tb-clear\\\\\\\">\\\\n    <span class=\\\\\\\"tb-property-type\\\\\\\">淘宝价</span>\\\\n    <div class=\\\\\\\"tb-property-cont\\\\\\\">\\\\n        <div id=\\\\\\\"J_Promo\\\\\\\" class=\\\\\\\"tb-promo-mod\\\\\\\">\\\\n            <div id=\\\\\\\"J_PromoHd\\\\\\\" class=\\\\\\\"tb-promo-hd tb-promo-item\\\\\\\"><div class=\\\\\\\"tb-promo-item-bd\\\\\\\"><strong class=\\\\\\\"tb-promo-price\\\\\\\"><em class=\\\\\\\"tb-rmb\\\\\\\">¥</em><em id=\\\\\\\"J_PromoPriceNum\\\\\\\" class=\\\\\\\"tb-rmb-num\\\\\\\">175.00-819.00</em></strong><span id=\\\\\\\"J_PromoType\\\\\\\" class=\\\\\\\"tb-promo-type\\\\\\\">黑五价</span><span id=\\\\\\\"J_PromoTips\\\\\\\" class=\\\\\\\"tb-promo-tips\\\\\\\"></span></div><div class=\\\\\\\"tb-promo-item-ft\\\\\\\"></div></div>\\\\n            <div id=\\\\\\\"J_PromoBd\\\\\\\" class=\\\\\\\"tb-promo-bd\\\\\\\"></div>\\\\n        </div>\\\\n    </div>\\\\n</li>\\\\n<li id=\\\\\\\"J_Duty\\\\\\\"></li>\\\\n<li id=\\\\\\\"J_ActivityPrice\\\\\\\"></li>\\\\n<li id=\\\\\\\"J_OtherDiscount\\\\\\\" class=\\\\\\\"tb-clear\\\\\\\">\\\\n    <span class=\\\\\\\"tb-property-type\\\\\\\">优惠</span>\\\\n    <div class=\\\\\\\"tb-other-discount\\\\\\\">\\\\n    <div class=\\\\\\\"tb-other-discount-content\\\\\\\"><div class=\\\\\\\"tb-coupon\\\\\\\">\\\\n    \\\\n        <img class=\\\\\\\"tb-coupon-icon\\\\\\\" src=\\\\\\\"//img.alicdn.com/tps/TB1xlnONpXXXXa9aXXXXXXXXXXX-80-16.png\\\\\\\" srcset=\\\\\\\"//img.alicdn.com/tps/TB1xlnONpXXXXa9aXXXXXXXXXXX-80-16.png 1x, //img.alicdn.com/tps/TB1HZofNpXXXXacXpXXXXXXXXXX-155-32.png 2x\\\\\\\">\\\\n    \\\\n    180元店铺优惠券，满1200元可用\\\\n    \\\\n        \\\\n            <a class=\\\\\\\"J_coupon\\\\\\\" href=\\\\\\\"#\\\\\\\" data-type=\\\\\\\"shopcoupon\\\\\\\" data-activityid=\\\\\\\"11ec3e7828c641d49fcd6bb9fe4858a5\\\\\\\" data-spm-click=\\\\\\\"gostr=/tbdetail;locaid=coupon\\\\\\\">领取</a>\\\\n        \\\\n    \\\\n</div>\\\\n\\\\n<div class=\\\\\\\"tb-coupon\\\\\\\">\\\\n    \\\\n        <img class=\\\\\\\"tb-coupon-icon\\\\\\\" src=\\\\\\\"//img.alicdn.com/tps/TB1xlnONpXXXXa9aXXXXXXXXXXX-80-16.png\\\\\\\" srcset=\\\\\\\"//img.alicdn.com/tps/TB1xlnONpXXXXa9aXXXXXXXXXXX-80-16.png 1x, //img.alicdn.com/tps/TB1HZofNpXXXXacXpXXXXXXXXXX-155-32.png 2x\\\\\\\">\\\\n    \\\\n    150元店铺优惠券，满1000元可用\\\\n    \\\\n        \\\\n            <a class=\\\\\\\"J_coupon\\\\\\\" href=\\\\\\\"#\\\\\\\" data-type=\\\\\\\"shopcoupon\\\\\\\" data-activityid=\\\\\\\"1176542d4a5d4a06b5f3af0ebf556653\\\\\\\" data-spm-click=\\\\\\\"gostr=/tbdetail;locaid=coupon\\\\\\\">领取</a>\\\\n        \\\\n    \\\\n</div></div></div>\\\\n</li>\\\\n<li id=\\\\\\\"J_Counter\\\\\\\" class=\\\\\\\"tb-counter\\\\\\\">\\\\n    <span class=\\\\\\\"tb-property-type\\\\\\\">销量</span>\\\\n    <div class=\\\\\\\"tb-counter-bd\\\\\\\">\\\\n        <div class=\\\\\\\"tb-rate-counter\\\\\\\">\\\\n            <a id=\\\\\\\"J_ReviewTabTrigger\\\\\\\" href=\\\\\\\"javascript:;\\\\\\\">\\\\n                <strong id=\\\\\\\"J_RateCounter\\\\\\\">4129</strong>\\\\n                <span>累计评论</span>\\\\n            </a>\\\\n        </div>\\\\n        <div class=\\\\\\\"tb-sell-counter\\\\\\\">\\\\n            <a href=\\\\\\\"javascript:;\\\\\\\" title=\\\\\\\"30天内已售出1081件，其中交易成功740件\\\\\\\">\\\\n                <strong id=\\\\\\\"J_SellCounter\\\\\\\">740</strong>\\\\n                <span>交易成功</span>\\\\n            </a>\\\\n        </div>\\\\n    </div>\\\\n</li>\\\\n<li id=\\\\\\\"J_MorePromoSlider\\\\\\\" class=\\\\\\\"tb-more-promo-slider tb-clearfix\\\\\\\" style=\\\\\\\"display: none\\\\\\\">\\\\n    <ul id=\\\\\\\"J_MorePromoList\\\\\\\"></ul>\\\\n    <div class=\\\\\\\"post-script\\\\\\\">以上价格可在付款时选择享用</div>\\\\n</li>\\\\n            </ul>\\\\n            \\\\n            <div id=\\\\\\\"J_StepPrice\\\\\\\"></div>\\\\n            \\\\n            <div id=\\\\\\\"J_logistic\\\\\\\"><div class=\\\\\\\"tb-logistic tb-clearfix\\\\\\\"><span class=\\\\\\\"tb-name tb-property-type\\\\\\\">配送</span><div id=\\\\\\\"J_LogisticInfo\\\\\\\" class=\\\\\\\"tb-logistic-info\\\\\\\"><div class=\\\\\\\"wl-areainfo clearfix\\\\\\\"><span id=\\\\\\\"J_WlAreaInfo\\\\\\\" class=\\\\\\\"wl-areacon\\\\\\\"><span id=\\\\\\\"J-From\\\\\\\">浙江温州</span> 至 <span id=\\\\\\\"J-To\\\\\\\"><span class=\\\\\\\"wl-addressinfo\\\\\\\" id=\\\\\\\"J_WlAddressInfo\\\\\\\" title=\\\\\\\"浙江杭州\\\\\\\">浙江杭州 <s></s></span></span></span><span class=\\\\\\\"loading\\\\\\\" id=\\\\\\\"J-Loading\\\\\\\"></span></div><div id=\\\\\\\"J_WlServiceInfo\\\\\\\" class=\\\\\\\"wl-serviceinfo\\\\\\\"><span class=\\\\\\\"wl-servicetitle\\\\\\\" id=\\\\\\\"J_WlServiceTitle\\\\\\\">快递 免运费 <s></s></span></div><div id=\\\\\\\"serviceFeeListInfo\\\\\\\" class=\\\\\\\"wl-serviceinfo\\\\\\\"></div><div id=\\\\\\\"J_WlServiceTitleMark\\\\\\\" class=\\\\\\\"wl-serviceinfo\\\\\\\"></div></div></div></div>\\\\n            \\\\n                <div id=\\\\\\\"J_SepLine\\\\\\\" class=\\\\\\\"sep-line\\\\\\\"></div>\\\\n                \\\\n                    <div id=\\\\\\\"J_isku\\\\\\\" class=\\\\\\\"tb-key tb-key-sku\\\\\\\" shortcut-key=\\\\\\\"i\\\\\\\" shortcut-label=\\\\\\\"挑选宝贝\\\\\\\" shortcut-effect=\\\\\\\"focus\\\\\\\">\\\\n                        <div class=\\\\\\\"tb-skin\\\\\\\">\\\\n                            \\\\n<dl class=\\\\\\\"J_Prop tb-prop tb-clear \\\\\\\">\\\\n        <dt class=\\\\\\\"tb-property-type\\\\\\\">剩余保质期</dt>\\\\n        <dd>\\\\n            <ul data-property=\\\\\\\"剩余保质期\\\\\\\" class=\\\\\\\"J_TSaleProp tb-clearfix\\\\\\\">\\\\n                <li data-value=\\\\\\\"10723838:106826\\\\\\\" class=\\\\\\\"tb-selected\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>6个月以上</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                \\\\n            </ul>\\\\n        </dd>\\\\n    </dl>\\\\n    \\\\n\\\\n<dl class=\\\\\\\"J_Prop tb-prop tb-clear \\\\\\\">\\\\n        <dt class=\\\\\\\"tb-property-type\\\\\\\">食品口味</dt>\\\\n        <dd>\\\\n            <ul data-property=\\\\\\\"食品口味\\\\\\\" class=\\\\\\\"J_TSaleProp tb-clearfix\\\\\\\">\\\\n                \\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:10164725596\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>保税：黑钻/鸡肉22磅（标粒）</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:10467837071\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>保税：黑钻/红肉22磅(标粒）</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:8899900192\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/红肉22磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:8899697590\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/鸡肉22磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:10069009923\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>保税：黑钻/鸡肉11磅(小粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:9426320197\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/鸡肉11磅(小粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:9426320198\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/红肉11磅(小粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:9426320199\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/鸡肉5磅(小粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:9426320200\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/红肉5磅(小粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:8899900195\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/鸡肉5磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:8899900196\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/红肉5磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:9240342912\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/北湖鸭5磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:8899900198\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/七种鱼5磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:9321829129\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>保税：黑钻/北湖鸭肉22磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:8899900199\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：黑钻/幼犬火鸡22磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:10612822623\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>保税：黑钻/七种鱼22磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:10976230207\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>保税：涂层/鸡肉成犬22磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:9240342916\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：涂层/牛肉成犬22磅(标粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:9426320201\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：涂层/鸡肉成犬5磅(小粒)</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                <li data-value=\\\\\\\"122216494:11082263894\\\\\\\">\\\\n                            <a href=\\\\\\\"javascript:void(0);\\\\\\\">\\\\n                                <span>现货：金汐/五种肉22磅（标粒）</span>\\\\n                            </a>\\\\n                            <i>已选中</i>\\\\n                        </li>\\\\n                    \\\\n                \\\\n                    \\\\n                \\\\n                    \\\\n                \\\\n                    \\\\n                \\\\n            </ul>\\\\n        </dd>\\\\n    </dl>\\\\n    \\\\n\\\\n                            <dl class=\\\\\\\"tb-amount tb-clear\\\\\\\">\\\\n    <dt class=\\\\\\\"tb-property-type\\\\\\\">数量</dt>\\\\n    <dd>\\\\n        <span class=\\\\\\\"tb-stock\\\\\\\" id=\\\\\\\"J_Stock\\\\\\\">\\\\n            <a href=\\\\\\\"javascript:void(0);\\\\\\\" title=\\\\\\\"减1\\\\\\\" hidefocus=\\\\\\\"\\\\\\\" class=\\\\\\\"tb-reduce J_Reduce tb-iconfont tb-disable-reduce\\\\\\\">ƛ</a>\\\\n            <input id=\\\\\\\"J_IptAmount\\\\\\\" type=\\\\\\\"text\\\\\\\" class=\\\\\\\"tb-text\\\\\\\" value=\\\\\\\"1\\\\\\\" maxlength=\\\\\\\"8\\\\\\\" title=\\\\\\\"请输入购买量\\\\\\\">\\\\n            <a href=\\\\\\\"javascript:void(0);\\\\\\\" hidefocus=\\\\\\\"\\\\\\\" class=\\\\\\\"tb-increase J_Increase tb-iconfont\\\\\\\" title=\\\\\\\"加1\\\\\\\">ƚ</a>件\\\\n        </span>\\\\n        <em>(库存<span id=\\\\\\\"J_SpanStock\\\\\\\" class=\\\\\\\"tb-count\\\\\\\">1860</span>件)</em>\\\\n        \\\\n\\\\n        \\\\n\\\\n    </dd>\\\\n</dl>\\\\n    <dl id=\\\\\\\"J_DlChoice\\\\\\\" class=\\\\\\\"tb-choice tb-clear\\\\\\\">\\\\n        <dt>请选择：</dt>\\\\n        <dd>\\\\n            \\\\n                <em>剩余保质期</em>\\\\n            \\\\n                <em>食品口味</em>\\\\n            \\\\n        </dd>\\\\n    </dl>\\\\n\\\\n<div id=\\\\\\\"J_SureSKU\\\\\\\" class=\\\\\\\"tb-sure\\\\\\\">\\\\n    <p class=\\\\\\\"tb-choice\\\\\\\">请勾选您要的商品信息</p>\\\\n    <p class=\\\\\\\"tb-sure-continue\\\\\\\">\\\\n        <a id=\\\\\\\"J_SureContinue\\\\\\\" href=\\\\\\\"javascript:;\\\\\\\">确定</a>\\\\n    </p>\\\\n    <span class=\\\\\\\"close J_Close tb-iconfont\\\\\\\">ß</span>\\\\n</div>\\\\n<div class=\\\\\\\"tb-msg tb-hidden\\\\\\\" style=\\\\\\\"display: none;\\\\\\\"><p class=\\\\\\\"tb-stop\\\\\\\">发生错误</p></div><div id=\\\\\\\"J_juValid\\\\\\\" class=\\\\\\\"tb-action tb-clearfix \\\\\\\">\\\\n    \\\\n\\\\n    <div class=\\\\\\\"tb-btn-buy\\\\\\\">\\\\n        \\\\n        <a href=\\\\\\\"javascript:;\\\\\\\" title=\\\\\\\"点击此按钮，到下一步确认购买信息\\\\\\\" class=\\\\\\\"J_LinkBuy\\\\\\\" shortcut-key=\\\\\\\"b\\\\\\\" shortcut-label=\\\\\\\"立即购买\\\\\\\" shortcut-effect=\\\\\\\"click\\\\\\\" data-addfastbuy=\\\\\\\"true\\\\\\\" data-spm-click=\\\\\\\"gostr=/tbdetail;locaid=d1\\\\\\\">\\\\n                立即购买\\\\n            </a>\\\\n        \\\\n    </div>\\\\n\\\\n    <div class=\\\\\\\"tb-btn-add\\\\\\\">\\\\n        \\\\n            <a href=\\\\\\\"javascript:;\\\\\\\" title=\\\\\\\"加入购物车\\\\\\\" class=\\\\\\\"J_LinkAdd\\\\\\\" shortcut-key=\\\\\\\"a\\\\\\\" shortcut-label=\\\\\\\"加入购物车\\\\\\\" shortcut-effect=\\\\\\\"click\\\\\\\" data-spm-click=\\\\\\\"gostr=/tbdetail;locaid=d2\\\\\\\">\\\\n                <i class=\\\\\\\"tb-iconfont\\\\\\\">ŭ</i>加入购物车\\\\n            </a>\\\\n        \\\\n    </div>\\\\n\\\\n\\\\n</div>\\\\n\\\\n                        </div>\\\\n                    </div>\\\\n                \\\\n            <div class=\\\\\\\"tb-extra\\\\\\\" id=\\\\\\\"J_tbExtra\\\\\\\"><dl><dt>承诺</dt><dd><a class=\\\\\\\"J_Cont\\\\\\\" title=\\\\\\\"卖家承诺为货品提供境外货源保障服务\\\\\\\" href=\\\\\\\"#\\\\\\\" target=\\\\\\\"_blank\\\\\\\"><img src=\\\\\\\"https://img.alicdn.com/tfs/TB1HI8IXW61gK0jSZFlXXXDKFXa-16-16.png\\\\\\\" srcset=\\\\\\\"https://img.alicdn.com/tfs/TB1qmlHX5_1gK0jSZFqXXcpaXXa-32-32.png 2x\\\\\\\">货源保障</a><a class=\\\\\\\"J_Cont\\\\\\\" title=\\\\\\\"该商品不支持7天无理由退货\\\\\\\" href=\\\\\\\"#\\\\\\\" target=\\\\\\\"_blank\\\\\\\"><img src=\\\\\\\"//img.alicdn.com/tfs/TB17CbJkeGSBuNjSspbXXciipXa-16-16.png\\\\\\\">不支持7天无理由</a><a title=\\\\\\\"卖家为您购买的商品投保退货运费险（保单生效以确认订单页展示的运费险为准）\\\\\\\" href=\\\\\\\"//ju.mmstat.com/?url=http://www.taobao.com/go/act/baoxian/yunfeixian.php?jlogid=p161456457c0a0\\\\\\\" target=\\\\\\\"_blank\\\\\\\"><img src=\\\\\\\"//img.alicdn.com/tfs/TB1XMnjQFXXXXXYXFXXXXXXXXXX-16-16.png\\\\\\\" srcset=\\\\\\\"//img.alicdn.com/tfs/TB1oOuTQFXXXXazapXXXXXXXXXX-32-32.png 2x\\\\\\\">运费险</a></dd></dl><dl><dt>支付</dt><dd><a href=\\\\\\\"//payservice.alipay.com/intro/index.htm?c=hb\\\\\\\" target=\\\\\\\"_blank\\\\\\\"><img src=\\\\\\\"//img.alicdn.com/tfs/TB1KTHfQFXXXXbnXFXXXXXXXXXX-16-16.png\\\\\\\" srcset=\\\\\\\"//img.alicdn.com/tfs/TB1XeDvQFXXXXc5XXXXXXXXXXXX-32-32.png 2x\\\\\\\">蚂蚁花呗</a><a href=\\\\\\\"//payservice.alipay.com/intro/index.htm?c=xyk\\\\\\\" target=\\\\\\\"_blank\\\\\\\"><img src=\\\\\\\"//img.alicdn.com/tfs/TB1w6O3QFXXXXX4aXXXXXXXXXXX-16-16.png\\\\\\\" srcset=\\\\\\\"//img.alicdn.com/tfs/TB1c7HAQFXXXXakXXXXXXXXXXXX-32-32.png 2x\\\\\\\">信用卡支付</a><a href=\\\\\\\"//jf.alipay.com\\\\\\\" target=\\\\\\\"_blank\\\\\\\"><img src=\\\\\\\"//img.alicdn.com/tfs/TB1dvGWQFXXXXcFaXXXXXXXXXXX-16-16.png\\\\\\\" srcset=\\\\\\\"//img.alicdn.com/tfs/TB1FdDlQFXXXXa5XpXXXXXXXXXX-32-32.png 2x\\\\\\\">集分宝</a></dd></dl>\\\\n    \\\\n</div>\\\\n        \\\\n    </div>\\\\n\\\",\\\"name\\\":\\\"纽翠斯狗粮黑钻红肉11磅幼犬粮5磅鸭哈根纽崔斯进口冻干鸡肉22磅\\\",\\\"attributes\\\":[\\\"品牌: Nutrience纽翠斯\\\",\\\"品名: Nutrience纽翠斯狗粮全系列\\\",\\\"分类: 犬粮\\\",\\\"适用犬品种: 通用型\\\",\\\"毛重: 11kg\\\",\\\"重量(g): 10000\\\",\\\"适用阶段: 全犬期\\\",\\\"包装方式: 盒装\\\",\\\"剩余保质期: 6个月以上\\\",\\\"适用犬体型: 通用型\\\",\\\"食品口味: 黑钻鸡22磅2包560*2联系客服改价 保税：黑钻/鸡肉22磅（标粒） 保税：黑钻/红肉22磅(标粒） 现货：黑钻/红肉22磅(标粒) 现货：黑钻/鸡肉22磅(标粒) 保税：黑钻/鸡肉11磅(小粒) 现货：黑钻/鸡肉11磅(小粒) 现货：黑钻/红肉11磅(小粒) 现货：黑钻/鸡肉5磅(小粒) 现货：黑钻/红肉5磅(小粒) 现货：黑钻/鸡肉5磅(标粒) 现货：黑钻/红肉5磅(标粒) 现货：黑钻/北湖鸭5磅(标粒) 现货：黑钻/七种鱼5磅(标粒) 保税：黑钻/北湖鸭肉22磅(标粒) 现货：黑钻/幼犬火鸡22磅(标粒) 保税：黑钻/七种鱼22磅(标粒) 保税：涂层/鸡肉成犬22磅(标粒) 现货：涂层/牛肉成犬22磅(标粒) 现货：涂层/鸡肉成犬5磅(小粒) 现货：金汐/五种肉22磅（标粒） 现货：涂层/鸡肉成犬11磅(小粒) 现货：涂层/鸡肉幼犬22磅(标粒) 现货：涂层/鸡肉幼犬5磅(标粒)\\\",\\\"原产地: 加拿大\\\",\\\"犬主粮分类: 干粮\\\",\\\"生产厂家地址: Nutrience纽翠斯\\\",\\\"生产厂家名称: Nutrience纽翠斯\\\",\\\"适用犬种: 全犬种 其他 吉娃娃 哈士奇 巴哥犬 德国牧羊犬 拉布拉多 柯基 比熊 泰迪 约克夏 萨摩耶 西施犬 贵宾 边境牧羊犬 金毛 阿拉斯加 雪纳瑞\\\"],\\\"comment\\\":\\\"4129\\\",\\\"promos\\\":[\\\"180元店铺优惠券，满1200元可用 领取\\\",\\\"150元店铺优惠券，满1000元可用 领取\\\"],\\\"props\\\":{\\\"食品口味\\\":[\\\"黑钻鸡22磅2包560*2联系客服改价\\\",\\\"保税：黑钻/鸡肉22磅（标粒）\\\",\\\"保税：黑钻/红肉22磅(标粒）\\\",\\\"现货：黑钻/红肉22磅(标粒)\\\",\\\"现货：黑钻/鸡肉22磅(标粒)\\\",\\\"保税：黑钻/鸡肉11磅(小粒)\\\",\\\"现货：黑钻/鸡肉11磅(小粒)\\\",\\\"现货：黑钻/红肉11磅(小粒)\\\",\\\"现货：黑钻/鸡肉5磅(小粒)\\\",\\\"现货：黑钻/红肉5磅(小粒)\\\",\\\"现货：黑钻/鸡肉5磅(标粒)\\\",\\\"现货：黑钻/红肉5磅(标粒)\\\",\\\"现货：黑钻/北湖鸭5磅(标粒)\\\",\\\"现货：黑钻/七种鱼5磅(标粒)\\\",\\\"保税：黑钻/北湖鸭肉22磅(标粒)\\\",\\\"现货：黑钻/幼犬火鸡22磅(标粒)\\\",\\\"保税：黑钻/七种鱼22磅(标粒)\\\",\\\"保税：涂层/鸡肉成犬22磅(标粒)\\\",\\\"现货：涂层/牛肉成犬22磅(标粒)\\\",\\\"现货：涂层/鸡肉成犬5磅(小粒)\\\",\\\"现货：金汐/五种肉22磅（标粒）\\\",\\\"现货：涂层/鸡肉成犬11磅(小粒)\\\",\\\"现货：涂层/鸡肉幼犬22磅(标粒)\\\",\\\"现货：涂层/鸡肉幼犬5磅(标粒)\\\"],\\\"剩余保质期\\\":[\\\"6个月以上\\\"]},\\\"tags\\\":{},\\\"J_AttrList\\\":\\\"\\\\n    \\\\n\\\\t<div id=\\\\\\\"J_Qualification\\\\\\\" data-spm=\\\\\\\"qualification-icon\\\\\\\"><div class=\\\\\\\"tb-qualification clearfix\\\\\\\"><dl>  <dt class=\\\\\\\"tb-qualification-title\\\\\\\">    <img src=\\\\\\\"//img.alicdn.com/tps/TB1hWz.IXXXXXbNXXXXXXXXXXXX.png\\\\\\\" alt=\\\\\\\"商品资质\\\\\\\">    <p>商品资质</p>    <span></span>    <i></i>  </dt>  <dd class=\\\\\\\"tb-qualification-items\\\\\\\">       <a href=\\\\\\\"javascript:void(0)\\\\\\\" data-src=\\\\\\\"//img.alicdn.com/imgextra/i2/3839909692/O1CN01OVUT5v2LSzGoGRO21_!!3839909692.png,//img.alicdn.com/imgextra/i3/3839909692/O1CN01LkQCpd2LSzH3BHgu6_!!3839909692.png\\\\\\\" data-name=\\\\\\\"\\\\\\\" data-spm-click=\\\\\\\"gostr=/tbdetail;locaid=d0;name=&amp;itemid=597308720185\\\\\\\">      <img class=\\\\\\\"tb-qualification-items-icon\\\\\\\" src=\\\\\\\"//img.alicdn.com/bao/uploaded/i4/TB17SE_g7Y2gK0jSZFgdjM5OFXa\\\\\\\" alt=\\\\\\\"\\\\\\\">      <p class=\\\\\\\"tb-qualification-items-type\\\\\\\">境外货源保障</p>      <div title=\\\\\\\"点击查看大图\\\\\\\">        <p>卖家承诺为货品提供境外货源保障承诺</p>                    <img src=\\\\\\\"//img.alicdn.com/imgextra/i2/3839909692/O1CN01OVUT5v2LSzGoGRO21_!!3839909692.png_240x10000.jpg\\\\\\\">                    <img src=\\\\\\\"//img.alicdn.com/imgextra/i3/3839909692/O1CN01LkQCpd2LSzH3BHgu6_!!3839909692.png_240x10000.jpg\\\\\\\">               </div>    </a>     </dd></dl></div></div>\\\\n\\\\n\\\\n    \\\\n\\\\n    \\\\n\\\\n\\\\n    \\\\n\\\\n    \\\\n\\\\n    <!-- attributes div start -->\\\\n    \\\\n        <ul class=\\\\\\\"attributes-list\\\\\\\">\\\\n\\\\n        \\\\n            <li title=\\\\\\\"Nutrience纽翠斯\\\\\\\">品牌:&nbsp;Nutrience纽翠斯</li>\\\\n            \\\\n            <li title=\\\\\\\"Nutrience纽翠斯狗粮全系列\\\\\\\">品名:&nbsp;Nutrience纽翠斯狗粮全系列</li>\\\\n            \\\\n            <li title=\\\\\\\"犬粮\\\\\\\">分类:&nbsp;犬粮</li>\\\\n            \\\\n            <li title=\\\\\\\"通用型\\\\\\\">适用犬品种:&nbsp;通用型</li>\\\\n            \\\\n            <li title=\\\\\\\"11kg\\\\\\\">毛重:&nbsp;11kg</li>\\\\n            \\\\n            <li title=\\\\\\\"10000\\\\\\\">重量(g):&nbsp;10000</li>\\\\n            \\\\n            <li title=\\\\\\\"全犬期\\\\\\\">适用阶段:&nbsp;全犬期</li>\\\\n            \\\\n            <li title=\\\\\\\"盒装\\\\\\\">包装方式:&nbsp;盒装</li>\\\\n            \\\\n            <li title=\\\\\\\"6个月以上\\\\\\\">剩余保质期:&nbsp;6个月以上</li>\\\\n            \\\\n            <li title=\\\\\\\"通用型\\\\\\\">适用犬体型:&nbsp;通用型</li>\\\\n            \\\\n            <li title=\\\\\\\"黑钻鸡22磅2包560*2联系客服改价 保税：黑钻/鸡肉22磅（标粒） 保税：黑钻/红肉22磅(标粒） 现货：黑钻/红肉22磅(标粒) 现货：黑钻/鸡肉22磅(标粒) 保税：黑钻/鸡肉11磅(小粒) 现货：黑钻/鸡肉11磅(小粒) 现货：黑钻/红肉11磅(小粒) 现货：黑钻/鸡肉5磅(小粒) 现货：黑钻/红肉5磅(小粒) 现货：黑钻/鸡肉5磅(标粒) 现货：黑钻/红肉5磅(标粒) 现货：黑钻/北湖鸭5磅(标粒) 现货：黑钻/七种鱼5磅(标粒) 保税：黑钻/北湖鸭肉22磅(标粒) 现货：黑钻/幼犬火鸡22磅(标粒) 保税：黑钻/七种鱼22磅(标粒) 保税：涂层/鸡肉成犬22磅(标粒) 现货：涂层/牛肉成犬22磅(标粒) 现货：涂层/鸡肉成犬5磅(小粒) 现货：金汐/五种肉22磅（标粒） 现货：涂层/鸡肉成犬11磅(小粒) 现货：涂层/鸡肉幼犬22磅(标粒) 现货：涂层/鸡肉幼犬5磅(标粒)\\\\\\\">食品口味:&nbsp;黑钻鸡22磅2包560*2联系客服改价 保税：黑钻/鸡肉22磅（标粒） 保税：黑钻/红肉22磅(标粒） 现货：黑钻/红肉22磅(标粒) 现货：黑钻/鸡肉22磅(标粒) 保税：黑钻/鸡肉11磅(小粒) 现货：黑钻/鸡肉11磅(小粒) 现货：黑钻/红肉11磅(小粒) 现货：黑钻/鸡肉5磅(小粒) 现货：黑钻/红肉5磅(小粒) 现货：黑钻/鸡肉5磅(标粒) 现货：黑钻/红肉5磅(标粒) 现货：黑钻/北湖鸭5磅(标粒) 现货：黑钻/七种鱼5磅(标粒) 保税：黑钻/北湖鸭肉22磅(标粒) 现货：黑钻/幼犬火鸡22磅(标粒) 保税：黑钻/七种鱼22磅(标粒) 保税：涂层/鸡肉成犬22磅(标粒) 现货：涂层/牛肉成犬22磅(标粒) 现货：涂层/鸡肉成犬5磅(小粒) 现货：金汐/五种肉22磅（标粒） 现货：涂层/鸡肉成犬11磅(小粒) 现货：涂层/鸡肉幼犬22磅(标粒) 现货：涂层/鸡肉幼犬5磅(标粒)</li>\\\\n            \\\\n            <li title=\\\\\\\"加拿大\\\\\\\">原产地:&nbsp;加拿大</li>\\\\n            \\\\n            <li title=\\\\\\\"干粮\\\\\\\">犬主粮分类:&nbsp;干粮</li>\\\\n            \\\\n            <li title=\\\\\\\"Nutrience纽翠斯\\\\\\\">生产厂家地址:&nbsp;Nutrience纽翠斯</li>\\\\n            \\\\n            <li title=\\\\\\\"Nutrience纽翠斯\\\\\\\">生产厂家名称:&nbsp;Nutrience纽翠斯</li>\\\\n            \\\\n            <li title=\\\\\\\"全犬种 其他 吉娃娃 哈士奇 巴哥犬 德国牧羊犬 拉布拉多 柯基 比熊 泰迪 约克夏 萨摩耶 西施犬 贵宾 边境牧羊犬 金毛 阿拉斯加 雪纳瑞\\\\\\\">适用犬种:&nbsp;全犬种 其他 吉娃娃 哈士奇 巴哥犬 德国牧羊犬 拉布拉多 柯基 比熊 泰迪 约克夏 萨摩耶 西施犬 贵宾 边境牧羊犬 金毛 阿拉斯加 雪纳瑞</li>\\\\n            \\\\n        \\\\n        </ul>\\\\n    \\\\n\\\\n\\\\n    \\\\n\\\\n\\\\n        \\\\n   \\\\n\\\"}\"}";
        String source = "taobao";
        System.out.println(test(content,source));
    }
}
